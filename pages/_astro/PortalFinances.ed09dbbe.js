import{m as K,a as z}from"./session.2e74c0ca.js";import{_ as Z}from"./_plugin-vue_export-helper.c27b6911.js";import{u as k}from"./index.2e5f7d57.js";import{d as j,o as ee,c as te,t as ne}from"./runtime-core.esm-bundler.52646ad2.js";const se=0,re=1,L=10;let G=(e,s,t,r)=>(e.events=e.events||{},e.events[t+L]||(e.events[t+L]=r(l=>{e.events[t].reduceRight((u,g)=>(g(u),u),{shared:{},...l})})),e.events[t]=e.events[t]||[],e.events[t].push(s),()=>{let l=e.events[t],u=l.indexOf(s);l.splice(u,1),l.length||(delete e.events[t],e.events[t+L](),delete e.events[t+L])}),ie=(e,s)=>G(e,s,se,t=>{let r=e.listen;return e.listen=l=>(!e.lc&&!e.starting&&(e.starting=!0,t(),delete e.starting),r(l)),()=>{e.listen=r}}),oe=(e,s)=>G(e,s,re,t=>{let r=e.off;return e.off=()=>{t(),r()},()=>{e.off=r}}),ae=()=>({events:{},emit(e,...s){let t=this.events[e]||[];for(let r=0,l=t.length;r<l;r++)t[r](...s)},on(e,s){return this.events[e]?.push(s)||(this.events[e]=[s]),()=>{this.events[e]=this.events[e]?.filter(t=>s!==t)}}});const ue=({cache:e=new Map,fetcher:s,...t}={})=>{const r=ae();let l=!0;P("focus",()=>{l=!0,r.emit(B)}),P("blur",()=>l=!1),P("online",()=>r.emit(Y));const u=new Map,g=new Map,F=new Map;let M={};const A=async([n,d],o,i,m)=>{var _;if(!l)return;const a=c=>{o.key===n&&(o.set(c),r.emit(U,n,c,!0))},f=()=>{a({...o.value,...b,promise:F.get(n)})},{dedupeTime:v=4e3,fetcher:p}={...i,...M},S=H();if(F.has(n)){o.value.loading||f();return}if(!m){const c=e.get(n);c&&o.value.data!==c&&a({data:c,...T});const O=g.get(n);if(O&&O+v>S)return}try{const c=p(...d);g.set(n,S),F.set(n,c),f();const O=await c;e.set(n,O),a({data:O,...T}),g.set(n,H())}catch(c){(_=i.onError)==null||_.call(i,c),a({data:o.value.data,error:c,...T})}finally{F.delete(n)}},J=(n,{fetcher:d=s,...o}={})=>{const i=K({...T}),m={...t,...o,fetcher:d};i.invalidate=()=>{const{key:h}=i;h&&R(h)},i.mutate=h=>{const{key:w}=i;w&&I(w,h)};let _,a,f,v,p,S=[];ie(i,()=>{const h=!_;[p,_]=le(n),v=p.subscribe(y=>{if(y){const[E,C]=y;i.key=E,A([E,C],i,m),a=E,f=C}else i.key=a=f=void 0});const w=p.get();w&&([a,f]=w,h&&c());const{refetchInterval:D=0,refetchOnFocus:W,refetchOnReconnect:X}=m,N=()=>{a&&A([a,f],i,m)};D>0&&u.set(n,setInterval(N,D)),W&&S.push(r.on(B,N)),X&&S.push(r.on(Y,N)),S.push(r.on(q,y=>{a&&x(a,y)&&A([a,f],i,m,!0)}),r.on(U,(y,E,C)=>{a&&x(a,y)&&i.value!==E&&i.value.data!==E&&i.set(C?E:{data:E,...T})}))});const c=()=>{a&&f&&A([a,f],i,m)},O=i.listen;return i.listen=h=>{const w=O(h);return h(i.value),c(),w},oe(i,()=>{i.value={...T},_?.(),S.forEach(w=>w()),S=[],v?.();const h=u.get(n);h&&clearInterval(h)}),i},V=n=>{e.delete(n),g.delete(n)},$=(n,d)=>{for(const o of e.keys())x(o,n)&&d(o)},R=n=>{$(n,V),r.emit(q,n)},I=(n,d)=>{$(n,o=>{d===void 0?V(o):e.set(o,d)}),r.emit(U,n,d)};function Q(n){const d=async i=>{var m,_;const a=(m=M.fetcher)!=null?m:n,f=[];try{o.set({error:void 0,data:void 0,mutate:d,...b});const v=await a({data:i,invalidate:p=>{f.push(p)},getCacheUpdater:(p,S=!0)=>[c=>{I(p,c),S&&f.push(p)},e.get(p)]});return o.setKey("data",v),v}catch(v){(_=t?.onError)==null||_.call(t,v),o.setKey("error",v)}finally{o.setKey("loading",!1),R(f)}},o=K({mutate:d,...T});return o}return[J,Q,{__unsafeOverruleSettings:n=>{console.warn("You should only use __unsafeOverruleSettings in test environment"),M=n},invalidateKeys:R,mutateCache:I}]},le=e=>{if(typeof e=="string")return[z([e,[e]]),()=>{}];let s=z(null),t=[];const r=()=>{t.some(u=>u==null)?s.set(null):s.set([t.join(""),t])},l=[];for(let u=0;u<e.length;u++){const g=e[u];if(typeof g=="string"){t.push(g);continue}l.push(g.subscribe(F=>{t[u]=F,r()}))}return r(),[s,()=>l.forEach(u=>u())]},B=1,Y=2,q=3,U=4,P=(e,s)=>{typeof window>"u"||addEventListener(e,s)},x=(e,s)=>Array.isArray(s)?s.includes(e):typeof s=="function"?s(e):e===s,H=()=>new Date().getTime(),b={loading:!0},T={loading:!1};function ce({baseUrl:e,...s}){return ue({fetcher:(...t)=>fetch([e,...t].join(""),s).then(r=>r.json())})}const[fe,we]=ce({baseUrl:"https://zolosake-api.pages.dev"}),de=fe(["/github/user"]),he=j({setup(){return{user:k(de)}},computed:{test(){return this.user.loading?"Lade Finanzen":this.user.error?"Error":(console.log(this.user.data),"true dummy")}}});function ve(e,s,t,r,l,u){return ee(),te("div",null,ne(e.test),1)}const Ee=Z(he,[["render",ve]]);export{Ee as default};
